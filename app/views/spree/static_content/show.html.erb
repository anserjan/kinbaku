<% if @page.layout.present? and @page.render_layout_as_partial? %>
  <%= render :partial => @page.layout %>
<% else %>
  <% content_for :sidebar do %>
    <div data-hook="homepage_sidebar_navigation">
      <% if "spree/products" == params[:controller] && @taxon %>
        <%= render partial: 'spree/shared/filters' %>
      <% end %>
    </div>
  <% end %>

  <div class="pages">
    <section class="page_body">
      <%= raw @page.body %>
    </section>
  </div>

  <% page_gallery_column = @page.content_blocks.find_by(content_type: :page_gallery_column) %>
  <% if page_gallery_column.present? %>
    <div class="page_gallery_container">
      <div class="">
        <% @page.content_blocks.reject{ |cb| cb.content_type == "page_gallery_column"}.each do |cb| %>
          <%= render partial: cb.content_type, locals: { cb: cb } if cb.visible %>
        <% end %>
      </div>
      <div class="page_gallery">
        <% page_gallery_column.content_images.each do |content_image| %>
          <%= image_tag content_image.image.variant(:product).processed.url, alt: content_image.alt %>
        <% end %>
      </div>
    </div>
  <% else %>
    <% @page.content_blocks.each do |cb| %>
      <%= render partial: cb.content_type, locals: { cb: cb } if cb.visible %>
    <% end %>
  <% end %>
<% end %>